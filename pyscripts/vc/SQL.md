```sql
-- RQ 1
-- PACKAGES WITH UNPARSEABLE HOSTS, NOT INCLUDED IN HOSTS TABLE SO NOT VERIFIED
SELECT groupid, artifactid, version, scm_url, scm_conn_url, dev_conn_url, homepage_url FROM packages p
WHERE NOT EXISTS
(SELECT 1 FROM hosts h
          WHERE p.groupid = h.groupid and p.artifactid = h.artifactid and p.version = h.version)


-- PACKAGES WITH NO VALID URLs
SELECT COUNT(*) FROM hosts
WHERE valid is null and valid_home is null and valid_dev_conn is null and valid_scm_conn is null;

-- PACKAGES WITH NO scm.url DEFINED (REPEAT THIS FOR ALL FIELDS)
SELECT COUNT(*) FROM packages
WHERE scm_url is null or scm_url = '';

-- PACKAGES WITH NO URLs DEFINED
SELECT COUNT(*) FROM packages
WHERE
(packages.scm_url is null or scm_url = '')
and (packages.homepage_url is null or homepage_url = '')
and (packages.dev_conn_url is null or dev_conn_url = '')
and (packages.scm_conn_url is null or scm_conn_url = '');

-- RQ2 --
-- 4 .CSV FILES GENERATED BY ANALYZE_HISTORICAL.PY, CHARTS MADE WITH GOOGLE SHEETS

-- RQ3 --
-- ALL PACKAGES FROM HOSTS ARE INCLUDED IN THE TAGS TABLE, IF THEY DONT HAVE ANY TAGS, ALL THE FIELDS EXCEPT (groupid, artifactid, version) WILL BE NULL
-- PACKAGES WITH AT LEAST A RELEASE OR A TAG
SELECT COUNT(*) FROM tags where tag_name is not null or release_name is not null;

-- PACKAGES WITH ONLY A MATCHING TAG
SELECT COUNT(*) FROM tags where tag_name is not null and release_name is null and url is not null;

-- PACKAGES WITH ONLY A MATCHING RELEASE
SELECT version, tag_name, release_name, release_tag_name FROM tags where tag_name is null and release_name is not null and url is not null;

-- PACKAGES WITHOUT TAG/RELEASE
SELECT COUNT(*) FROM tags where tag_name is null and release_name is null;

-- PACKAGES WITH EXACT TAG
SELECT COUNT(*) FROM tags where tag_name = version and (release_name != version or release_name is null);

-- PACKAGES WITH EXACT RELEASE
SELECT COUNT(*) FROM tags where (tag_name != version or tag_name is null) and release_name = version;

-- PACKAGES WITH EXACT TAG AND EXACT RELEASE
SELECT COUNT(*) FROM tags where tag_name = version and release_name = version;

-- PACKAGES WITH NO EXACT MATCH
SELECT COUNT(*) FROM tags where (tag_name != version or tag_name is null) and (release_name != version or release_name is null)

-- RQ4 --

-- PACKAGES WITH build.outputTimestamp GROUPED BY YEAR (TABLE 3)
SELECT date_part('year', lastmodified) AS year, COUNT(*) FROM packages p
JOIN package_list pl on p.groupid = pl.groupid and p.artifactid = pl.artifactid and p.version = pl.version
WHERE output_timestamp_prop is not null
GROUP BY year;

-- NUM OF REPRODUCIBLE FILES GROUP BY FILE EXTENSION
WITH ranked_rows AS (
    SELECT
        groupid,
        artifactid,
        version,
        ok_files,
        ROW_NUMBER() OVER (PARTITION BY groupid, artifactid, version ORDER BY cardinality(ok_files) DESC) AS row_number
    FROM
        builds
),
     filtered_rows AS (
         SELECT
             groupid,
             artifactid,
             version,
            ok_files
         FROM
             ranked_rows
         WHERE
                 row_number = 1
     ),
     unnested AS (
         SELECT
             filtered_rows.groupid,
             filtered_rows.artifactid,
             filtered_rows.version,
             unnest(filtered_rows.ok_files) AS filename
         FROM
             filtered_rows
     )
SELECT
    (regexp_matches(unnested.filename, '\.([^\.]*)$'))[1] AS extension,
    count(*) AS extension_count
FROM
    unnested
GROUP BY
    extension
ORDER BY
    extension_count DESC;

-- NUM OF NON-REPRODUCIBLE FILES GROUP BY FILE EXTENSION
WITH ranked_rows AS (
    SELECT
        groupid,
        artifactid,
        version,
        ko_files,
        ROW_NUMBER() OVER (PARTITION BY groupid, artifactid, version ORDER BY cardinality(ko_files) DESC) AS row_number
    FROM
        builds
),
     filtered_rows AS (
         SELECT
             groupid,
             artifactid,
             version,
             ko_files
         FROM
             ranked_rows
         WHERE
                 row_number = 1
     ),
     unnested AS (
         SELECT
             filtered_rows.groupid,
             filtered_rows.artifactid,
             filtered_rows.version,
             unnest(filtered_rows.ko_files) AS filename
         FROM
             filtered_rows
     )
SELECT
(regexp_matches(unnested.filename, '\.([^\.]*)$'))[1] AS extension,
count(*) AS extension_count
FROM
    unnested
GROUP BY
    extension
ORDER BY
    extension_count DESC;


-- NUM OF PARTIALLY REPRODUCIBLE FILES
WITH ranked_rows AS (
    SELECT
        groupid,
        artifactid,
        version,
        from_existing,
        build_success,
        ok_files,
        ko_files,
        ROW_NUMBER() OVER (PARTITION BY groupid, artifactid, version ORDER BY cardinality(ok_files) DESC) AS row_number
    FROM
        builds)
SELECT * FROM ranked_rows WHERE row_number = 1 AND build_success AND array_to_string(ko_files, ',') <> '' AND array_to_string(ok_files, '') <> '';
```



